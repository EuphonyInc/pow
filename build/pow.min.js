angular.module("pow",[]).run(["$templateCache",function(a){a.put("player.html",'<div class="player" style="box-sizing: border-box;margin: 0 auto;width: 325px;"> <div class="controls" style="box-sizing: border-box;background: #fafafa;padding: 8px;"> <svg id="playButton" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 41.999 41.999" style="box-sizing: border-box;fill: #595959;width: 20px;margin: 3px 0 0 0;font-size: 16px;text-align: center;display: inline-block;cursor: pointer;background: transparent;border: none;outline: none;"><path d="M36.068 20.176l-29-20C6.761-0.035 6.363-0.057 6.035 0.114 5.706 0.287 5.5 0.627 5.5 0.999v40c0 0.372 0.206 0.713 0.535 0.886 0.146 0.076 0.306 0.114 0.465 0.114 0.199 0 0.397-0.06 0.568-0.177l29-20c0.271-0.187 0.432-0.494 0.432-0.823S36.338 20.363 36.068 20.176z" style="box-sizing: border-box;"></path></svg> <div class="track" style="box-sizing: border-box;position: relative;width: 236px;margin: 7px 0 6px 16px;height: 5px;background-color: #666;display: inline-block;vertical-align: center;"> <div class="progress" style="box-sizing: border-box;position: absolute;width: 0%;height: 100%;background: #4487f2;"></div><div class="scrubber" style="box-sizing: border-box;position: absolute;width: 18px;height: 18px;border-radius: 50%;margin: -6.5px 0 0 -9px;background: #4487f2;cursor: pointer;"></div></div><svg id="downloadButton" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 471.2 471.2" style="box-sizing: border-box;fill: #595959;width: 20px;margin: 3px 0 0 15px;font-size: 16px;text-align: center;display: inline-block;cursor: pointer;background: transparent;border: none;outline: none;"><path d="M457.7 230.2c-7.5 0-13.5 6-13.5 13.5v122.8c0 33.4-27.2 60.5-60.5 60.5H87.5c-33.4 0-60.5-27.2-60.5-60.5v-124.8c0-7.5-6-13.5-13.5-13.5s-13.5 6-13.5 13.5v124.8c0 48.3 39.3 87.5 87.5 87.5h296.2c48.3 0 87.5-39.3 87.5-87.5v-122.8C471.2 236.3 465.2 230.2 457.7 230.2z" style="box-sizing: border-box;"></path><path d="M226.1 346.8c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4l85.8-85.8c5.3-5.3 5.3-13.8 0-19.1 -5.3-5.3-13.8-5.3-19.1 0l-62.7 62.8V30.8c0-7.5-6-13.5-13.5-13.5s-13.5 6-13.5 13.5v273.9l-62.8-62.8c-5.3-5.3-13.8-5.3-19.1 0 -5.3 5.3-5.3 13.8 0 19.1L226.1 346.8z" style="box-sizing: border-box;"></path></svg> </div></div>')}]),function(){"use strict";angular.module("pow").directive("pow",["$pow","$timeout",function(a,b){return{restrict:"E",templateUrl:"player.html",replace:!0,link:function(c,d,e,f){function g(a){this.ac=new(window.AudioContext||webkitAudioContext),this.url=h,this.el=a,this.button=a.children()[0].children[0],this.svgpath=a.children()[0].children[0].children[0],this.downloadButton=a.children()[0].children[2],this.track=a.children()[0].children[1],this.progress=a.children()[0].children[1].children[0],this.scrubber=a.children()[0].children[1].children[1],this.loading=!0,this.bindEvents()}c.$watch(e.arrayBuffer,function(a){"[object ArrayBuffer]"===c.data.arrayBuffer.__proto__.toString()&&(window.player.fetch(a),b(function(){c.data.arrayBuffer={}},0,!1))}),g.prototype.bindEvents=function(){this.downloadButton.addEventListener("click",this.download.bind(this)),this.button.addEventListener("click",this.toggle.bind(this)),this.scrubber.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mousemove",this.onDrag.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this))},g.prototype.fetch=function(a){a&&(this.loading=!0,this.decode(a))},g.prototype.decode=function(b){this.ac.decodeAudioData(b,function(b){this.buffer=b,this.wav=a.audioBufferToWav(b),this.position=0,this.draw(),this.loading=!1}.bind(this))},g.prototype.connect=function(){this.playing&&this.pause(),this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.ac.destination)},g.prototype.play=function(a){this.connect(),this.position="number"==typeof a?a:this.position||0,this.startTime=this.ac.currentTime-(this.position||0),this.source.start(this.ac.currentTime,this.position),this.playing=!0,console.log("path",this.svgpath)},g.prototype.pause=function(){this.source&&(this.source.stop(0),this.source=null,this.position=this.ac.currentTime-this.startTime,this.playing=!1)},g.prototype.seek=function(a){this.playing?this.play(a):this.position=a},g.prototype.updatePosition=function(){return this.position=this.playing?this.ac.currentTime-this.startTime:this.position,this.position>=this.buffer.duration&&(this.position=this.buffer.duration,this.pause()),this.position},g.prototype.toggle=function(){this.playing?this.pause():this.play()},g.prototype.download=function(){if(!this.loading){var a=document.createElement("a");document.body.appendChild(a),a.style="display: none";var b=new window.Blob([new DataView(this.wav)],{type:"audio/wav"}),c=window.URL.createObjectURL(b);a.href=c,a.download="audio.wav",a.click(),window.URL.revokeObjectURL(c)}},g.prototype.onMouseDown=function(a){this.dragging=!0,this.startX=a.pageX,this.startLeft=parseInt(this.scrubber.style.left||0,10)},g.prototype.onDrag=function(a){var b,c;this.dragging&&(b=this.track.offsetWidth,c=this.startLeft+(a.pageX-this.startX),c=Math.max(Math.min(b,c),0),this.scrubber.style.left=c+"px")},g.prototype.onMouseUp=function(){var a,b,c;this.dragging&&(a=this.track.offsetWidth,b=parseInt(this.scrubber.style.left||0,10),c=b/a*this.buffer.duration,this.seek(c),this.dragging=!1)},g.prototype.draw=function(){var a=this.updatePosition()/this.buffer.duration,b=this.track.offsetWidth;this.playing?this.button.innerHTML='<path d="M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z"/>':this.button.innerHTML='<path d="M36.068 20.176l-29-20C6.761-0.035 6.363-0.057 6.035 0.114 5.706 0.287 5.5 0.627 5.5 0.999v40c0 0.372 0.206 0.713 0.535 0.886 0.146 0.076 0.306 0.114 0.465 0.114 0.199 0 0.397-0.06 0.568-0.177l29-20c0.271-0.187 0.432-0.494 0.432-0.823S36.338 20.363 36.068 20.176z"/>',this.progress.style.width=a*b+"px",this.dragging||(this.scrubber.style.left=a*b+"px"),requestAnimationFrame(this.draw.bind(this))};var h="http://static.kevvv.in/sounds/callmemaybe.mp3";window.player=new g(d)}}}])}(),function(){"use strict";angular.module("pow").factory("$pow",function(){function a(a,b,f,g,h){var i=h/8,j=g*i,k=new ArrayBuffer(44+a.length*i),l=new DataView(k);return e(l,0,"RIFF"),l.setUint32(4,36+a.length*i,!0),e(l,8,"WAVE"),e(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,b,!0),l.setUint16(22,g,!0),l.setUint32(24,f,!0),l.setUint32(28,f*j,!0),l.setUint16(32,j,!0),l.setUint16(34,h,!0),e(l,36,"data"),l.setUint32(40,a.length*i,!0),1===b?d(l,44,a):c(l,44,a),k}function b(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}function c(a,b,c){for(var d=0;d<c.length;d++,b+=4)a.setFloat32(b,c[d],!0)}function d(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,e<0?32768*e:32767*e,!0)}}function e(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}return{audioBufferToWav:function(c,d){d=d||{};var e,f=c.numberOfChannels,g=c.sampleRate,h=d.float32?3:1,i=3===h?32:16;return e=2===f?b(c.getChannelData(0),c.getChannelData(1)):c.getChannelData(0),a(e,h,g,f,i)}}})}();
